{% extends 'base.html' %}
{% import 'macros.html' as macros with context %}

{% block head_title %}{{ note.title }}{% endblock %}
{% block body_title %}
  <form action="{{ url_for('star', path=note.path) }}" 
        class="d-inline-flex align-middle"
        method="POST">
    {% if note.starred %}
    <button type="submit" class="btn btn-warning">
      <span class="bi-star-fill" title="Unstar this note."></span>
    </button>
    {% else %}
    <button type="submit" class="btn btn-outline-warning">
      <span class="bi-star-fill" title="Star this note."></span>
    </button>
    {% endif %}
  </form>
{{ note.title }}
<button class="btn btn-clipboard btn-outline-none ps-0"
        data-clipboard-text="[[{{ note.path }}]]"
        title="Copy the path of the note to the clipboard.">
  <span class="bi-clipboard text-dark"></span>
</button>
{% endblock %}

{% block navbar %}
{% if interactive %}
<form action="{{ url_for('create') }}"
      class="mx-md-2 my-md-0"
      method="GET">
  {% if note.supernote %}
  <input type="hidden" name="supernote" value="{{ note.supernote.path }}">
  {% endif %}
  <input type="hidden" name="source" value="{{ note.path }}">
  <button type="submit" class="btn btn-outline-primary"
          title="Create a copy of this note.">Copy</button>
</form>
<form action="{{ url_for('create') }}"
      class="mx-md-2 my-md-0"
      method="GET">
  {% if note.path %}
  <input type="hidden" name="supernote" value="{{ note.path }}">
  {% endif %}
  <button type="submit" class="btn btn-outline-primary"
          title="Create a subnote for this note.">Subnote</button>
</form>
<form action="{{ url_for('delete', path=note.path) }}"
      class="mx-md-2 my-md-0"
      method="POST">
  <button role="submit" class="btn btn-outline-danger"
          {{ not note.is_deletable() and 'disabled' or '' }}
          onclick="return confirm('Really delete recursively? Cannot be undone.')"
          >Delete</button>
</form>
{% endif %} {# if interactive #}
{% endblock %} {# block navbar #}

{% block action %}
{% if interactive %}
<div class="d-grid gap-2">
  <a href="{{ url_for('edit', path=note.path) }}"
     class="btn btn-primary mt-2 mx-2">Edit</a>
</div>
{% endif %} {# if interactive #}
{% endblock %} {# block action #}

{% block meta %}
<small>{{ note.modified | localtime }}</small>
{% endblock %}

{% block left %}
<div class="card bg-light my-3">
  <div class="card-header py-1">Supernotes</div>
  <div class="card-body py-1">
    <ul class="list-unstyled my-0">
      <li>
        <a href="{{ url_for('home') }}" class="text-decoration-none">
          <i>&lt;root&gt;</i></a>
      </li>
      {% for supernote in note.supernotes()[1:] %}
      <li>
        <a href="{{ supernote.url }}" class="text-decoration-none">
          /{{ supernote.title }}</a>
      </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% if note.supernote %}
<div class="card my-3">
  <div class="card-header bg-info py-1">Sibling notes</div>
  <div class="card-body small py-1">
    <table width="100%">
      {% for sibling in note.supernote.subnotes %}
      <tr>
        <td class="py-0">
          {% if sibling == note %}
          <span class="text-muted">{{ sibling.title }}</span>
          {% else %}
          <a href="{{ sibling.url }}" class="text-decoration-none">
            {{ sibling.title }}</a>
          {% endif %}
        </td>
        <td class="text-end py-0">
          <button class="btn btn-clipboard btn-sm btn-outline-none p-0"
                  data-clipboard-text="[[{{ sibling.path }}]]"
                  title="Copy the path of the note to the clipboard.">
            <span class="bi-clipboard text-dark"></span>
          </button>
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
{% endif %} {# if note.supernote #}
{% include 'backlinks.html' %}
{% endblock %} {# block left #}

{% block main %}
{{ note['text'] | markdown }}
{{ macros.noteslist(note.subnotes, 2) }}
{% endblock %} {# block main #}

{% block right %}
{% if interactive %}
{% include 'starred.html' %}
{% include 'recent.html' %}
{% endif %} {# if interactive #}
{% endblock %}

{% block javascript %}
<script src="{{ url_for('static', filename='clipboard.min.js') }}"></script>
<script>
 var clipboard = new ClipboardJS('.btn-clipboard');
</script>
{% endblock %}
